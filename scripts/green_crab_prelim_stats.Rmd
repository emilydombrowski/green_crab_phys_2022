```{r data read in}

# read in relevant documents for this data
# preliminary data used for calcium etc.

# data used to produce calcium plots 
gc_dat <- read.csv("../data/prelim_gc_data.csv")

# updated with full data set 2023-01-06

gc_dat_fin <- read.csv("../data/Condo_Data_Raw_CML_WEL_1_6_23.csv")

# define color levels as factor for future analyses
gc_dat_fin$hemo_col <- factor(gc_dat_fin$hemo_col,
                           levels = c('1', '2', '3', '4', '5'))

gc_dat_fin$hemo_col <- as.factor(gc_dat_fin$hemo_col)

# define hemolymph refractive index (RI) as numerics
gc_dat_fin$hemo_ri <- as.numeric(gc_dat_fin$hemo_ri)

# data reclassification to avoid errors later

# libraries for data visualization
library(ggplot2)
library(dplyr)
library(gridExtra)
library(MASS)
library(janitor)
```

```{r Ca vs. color UNFILTERED...included WELLS and CML data}

# Two locations were used for data collection. Ultimately, Coastal
# Marine Lab (CML) data was not included due to inconsistencies
# in data collection. This was a preliminary visualization

boxplot(ca ~ hemo_col, data = gc_dat_fin,
      xlab = "Hemolymph Color",
      ylab = "Calcium (ppm)",
      col= c('white', 'aliceblue', 'bisque', 'darksalmon','coral'),
      
      subset = period == "TRUE", outline = FALSE)

# appears that calcium increases as hemolymph color darkens
# n = 25 individual crabs
# n = 11, 10, 36, 6, 2
```

```{r RI vs. Color FILTERED for WELLS only crabs}

boxplot(hemo_ri ~ hemo_col, data = gc_dat_fin,
      xlab = "Hemolymph Color",
      ylab = "Hemolymph Refractive Index",
      col= c('white', 'aliceblue', 'bisque', 'darksalmon','coral'),
      subset = condo_id == "WL" & 
        outcome == c('Molted', 'Removed'))

# n = 223, 211, 324, 53, and 16
```

```{r}
gc_dat_clean <- clean_names(gc_dat_fin)
# use janitor to clean

filt <- gc_dat_clean[gc_dat_clean$condo_id == "WL" & 
                     gc_dat_clean$outcome == c('Molted','Removed'),
                     c("crab_id", "hemo_ri", "hemo_col")]
# write data table with filtered data 

write.csv(filt, "filt_gc_dat.csv", 
          sep="\t",
          quote=F,
          row.names = F,
          col.names = T)

# make boxplot with filtered data to double check other graph
boxplot(hemo_ri ~ hemo_col, data = filt,
      xlab = "Hemolymph Color",
      ylab = "Hemolymph Refractive Index",
      col= c('white', 'aliceblue', 'bisque', 'darksalmon','coral'))

# n = 83, 85, 125, 21, 7
# gc n = 92
```


```{r Tukey HSD test and anova for color and RI fin filtered for WELLS}

fcol_fin <- factor(gc_dat_fin$hemo_col)
# color is on a scale of 1-5; appears as "numeric"; categorical factor

ri_col_aov_fin <- aov (hemo_ri ~ fcol_fin, data=gc_dat_fin,
                       subset = condo_id == "WL")
summary(ri_col_aov_fin)
# type 1 aov used for Tukey test
# tests between categories: is 1 dif. than 2, etc.

TukeyHSD(ri_col_aov_fin, conf.level = 0.95) 
```

```{r}

# wl_col_aov_fin <- aov (hemo_ri ~ hemo_col, data=gc_dat_fin, 
#                        subset = condo_id == "WL" & period == "TRUE" 
#                        & outcome == c('Molted', 'Removed'))
# summary(wl_col_aov_fin)
# # type 1 aov used for Tukey test
# # tests between categories: is 1 dif. than 2, etc.
# 
# TukeyHSD(wl_col_aov_fin, conf.level = 0.95) 

```


```{r RI vs. Calcium Plot ggplot with confidence int.}

# Preliminary visualization from older dataset

gc_dat %>% 
        # pipes molt data into ggplot
  ggplot(aes(x = RI, y = Ca)) + 
        # populates plot with hemo ri and ca info
    geom_point() + geom_smooth(method=lm) + 
        # specifies type of plot -- linear model with 95 percent confidence
        xlab("Hemolymph Refractive Index") + 
        ylab ("Calcium (ppm)")  +
        # renames x and y labels and title
      xlim(3, 12) + 
        # specifies x axis between 3 and 12 for more clear visualization
      theme(panel.grid.major = element_blank(),
              panel.grid.minor = element_blank(), 
              panel.background = element_blank())
```

```{r ca vs ri significance testing}
ca_ri_mod <- lm(Ca ~ RI, data = gc_dat)
nobs(ca_ri_mod) # tells that there are 127 observations used in this model
summary(ca_ri_mod)
anova(ca_ri_mod) # standard anova
car::Anova(ca_ri_mod, type = 3) # type 3 anova for significance testing
# taken from all during molt cycle, leading to lots of variation
# pointing to trend; small r^2 due to assessing crabs at different times of
# molt cycle
```
