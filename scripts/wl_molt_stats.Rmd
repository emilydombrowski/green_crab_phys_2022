```{r .csv and library read in}

molt_dat_fin <- read.csv("../data/wl_cml_molt_dat_final.csv")


molt_dat_fin$hemo_ri <- as.numeric(molt_dat_fin$hemo_ri)
molt_dat_fin$days_from_molt <- as.numeric(molt_dat_fin$days_from_molt)

pre_post_dat <- read.csv("../data/wl_cml_pre_post_ttest.csv")

library(dplyr)
library(car)
library(ggplot2)
# load relevant libraries for stats analysis
```

```{r}
# most updated

plot(hemo_ri ~ days_from_molt, data = molt_dat_fin,
     main = "Hemolymph RI as Green Crabs Approach Molt",
     xlab = "Days From Molt", 
     ylab = "Hemolymph RI",
     type = "b", subset =condo_id == "WL")
abline(lm (hemo_ri ~ days_from_molt, data = molt_dat), col = 4, lwd = 3)

```



```{r}

# upd data
molt_dat_fin %>% 
        # pipes molt data into ggplot
  ggplot(aes(x = days_from_molt, y = hemo_ri)) + 
        # populates plot with hemo ri info and defines color with crab ID
    geom_point() + geom_smooth(method=lm) + 
        # specifies type of plot -- linear model with confidence int
        scale_x_reverse() + 
        # reverses x axis so information counts down to molt
        xlab("Days from molt") + 
        ylab ("Hemolymph RI") +
        ggtitle("Hemolymph RI as green crabs approach molt")
        # renames x and y labels and title


```


```{r ri days from molt anova}

# WL CML 2022 data

ri_mod_fin <- lm(hemo_ri ~ days_from_molt, data = molt_dat_fin, 
                 subset = condo_id == "WL")
summary(ri_mod_fin)
anova(ri_mod_fin)
car::Anova(ri_mod_fin, type = 3)

# linear models for significance testing 
# r square of 0.04 -- no corellation

```

```{r hemo color and days to molt plot}

# WL CML Final 2022 data

plot(hemo_color ~ days_from_molt, data = molt_dat_fin,
     main = "Hemolymph Color as Green Crabs Approach Molt (n=13)",
     xlab = "Days From Molt", 
     ylab = "Hemolymph Color")
abline(lm (hemo_color ~ days_from_molt, data = molt_dat), col = 4, lwd = 3)


boxplot(days_from_molt ~ hemo_color, data = molt_dat_fin)

```

```{r hemo RI before and after molt}

molt_dat_fin$pre_post <- factor(molt_dat_fin$pre_post, 
                                levels = c('pre', 'post'))

boxplot(hemo_ri ~ pre_post, data = molt_dat_fin, 
        main = "Hemolymph Protein Before and After Molt",
        sub = "Wells Condo",
        xlab = "Pre- vs. Post- Molt",
        ylab = "Hemolymph Protein",
        col= c('steelblue4', 'plum'),
        subset = condo_id == "WL")

```

```{r t test for pre vs post molt hemolymph}

t.test(hemo_ri ~ pre_post, data = pre_post_dat, paired = TRUE, 
       alternative = "two.sided", subset = condo_id == "WL")

```

```{r}

log_model = glm(log(hemo_ri) ~ log(days_from_molt), family = binomial,
                    data = molt_dat_fin)
plot(log_model)

```