```{r data set up and reorganization}

se_dat <- read.csv("../data/se.csv")
# read in .csv

se_dat_upd <- read.csv ("../data/molt_dat_cml_wel_11_10_22.csv")
# updated .csv for 2021-2022 CML and WEL data

se_dat$start_end <- factor(se_dat$start_end, levels = c('start', 'end'))
se_dat$outcome <- factor(se_dat$outcome, levels = c('Removed', 'Dead',
                                                    'Molted', 'Intermolt'))
# define levels as factors for later graphing

se_dat_upd$hemo_ri <- as.numeric(se_dat_upd$hemo_ri)

se_dat_upd$start_end <- factor(se_dat_upd$start_end, 
                           levels = c('start', 'end'))

se_dat_upd$outcome <- factor(se_dat_upd$outcome, 
                         levels = c('Removed', 'Dead','Molted', 'Intermolt'))

se_dat_fin <- read.csv("../data/se_updated_final.csv")

as.numeric(se_dat_fin$outcome =="Molted")


se_dat_fin$hemo_ri <- as.numeric(se_dat_fin$hemo_ri)

se_dat_fin$start_end <- factor(se_dat_fin$start_end, 
                           levels = c('start', 'end'))

se_dat_fin$outcome <- factor(se_dat_fin$outcome, 
                         levels = c('Removed', 'Dead','Molted', 'Intermolt'))

library(ggplot2)
library(dplyr)
library(car)
# load relevant libraries
```

```{r initial vs final hemo RI in gc conditions}
boxplot(hemo_ri ~ start_end:outcome, data=se_dat,
        main = 'Initial vs. Final Hemolymph Protein of Removed, Dead, and 
        Molted Crabs',
        xlab = 'Condition', ylab = 'Hemolymph Protein',
        col= c('steelblue4', 'steelblue4', 'plum', 'plum', 'springgreen4',
               'springgreen4'))

```

```{r initial vs final hemo RI updated}
boxplot(hemo_ri ~ start_end:outcome, data=se_dat_upd,
        main = 'Initial vs. Final Hemolymph Protein of Removed, Dead, and 
        Molted Crabs',
        xlab = 'Condition', ylab = 'Hemolymph Protein',
        col= c('steelblue4', 'steelblue4', 'plum', 'plum', 'springgreen4',
               'springgreen4'))
```
```{r initial vs final hemo RI in gc conditions cml update}
boxplot(hemo_ri ~ start_end:outcome, data=se_dat_fin,
        main = 'Initial vs. Final Hemolymph Protein of Removed, Dead, and 
        Molted Crabs',
        xlab = 'Condition', ylab = 'Hemolymph Protein',
        col= c('steelblue4', 'steelblue4', 'plum', 'plum', 'springgreen4',
               'springgreen4'))

```

```{r boxplot Initial Hemo Protein in GC conditions}
plot(hemo_ri ~ outcome, data=se_dat,
        main = 'Initial Hemolymph Protein in Green Crabs',
        subset = start_end == "start",
        xlab = 'Condition', ylab = 'Hemolymph Protein',
        col= c('steelblue4', 'plum', 'springgreen4', 'steelblue1'))

# visualizes data looking at different conditions of gc against intermolt
```

```{r boxplot Initial Hemo Protein in GC conditions updated}
plot(hemo_ri ~ outcome, data=se_dat_upd,
        main = 'Initial Hemolymph Protein in Green Crabs',
        subset = start_end == "start",
        xlab = 'Condition', ylab = 'Hemolymph Protein',
        col= c('steelblue4', 'plum', 'springgreen4', 'steelblue1'))

```

```{r boxplot Initial Hemo Protein in GC conditions updated jan}
plot(hemo_ri ~ outcome, data=se_dat_fin,
        main = 'Initial Hemolymph Protein in Green Crabs',
        subset = start_end == "start",
        xlab = 'Condition', ylab = 'Hemolymph Protein',
        col= c('steelblue4', 'plum', 'springgreen4', 'steelblue1'))

```

```{r Initial Hemo Protein in GC conditions without dead category}

out_rmi <- factor(se_dat$outcome, levels = c('Removed', 'Molted', 'Intermolt'))
# sets parameters to compare removed, molted, and intermolt crabs

plot(hemo_ri ~ out_rmi, data=se_dat,
        main = 'Initial hemolymph protein concentration in green crabs',
        subset = start_end == "start",
        xlab = NULL, ylab = 'Protein Concentration',
        col= c('steelblue4', 'plum', 'springgreen4'))

```

```{r Initial Hemo Protein in GC conditions without dead category updated}

out_rmi_upd <- factor(se_dat_upd$outcome, levels = c('Removed', 'Molted', 'Intermolt'))
# sets parameters to compare removed, molted, and intermolt crabs

plot(hemo_ri ~ out_rmi_upd, data=se_dat_upd,
        main = 'Initial hemolymph protein concentration in green crabs',
        subset = start_end == "start",
        xlab = NULL, ylab = 'Protein Concentration',
        col= c('steelblue4', 'plum', 'springgreen4'))

```
```{r Initial Hemo Protein in GC conditions without dead category updated}

out_rmi_fin <- factor(se_dat_fin$outcome, levels = c('Removed', 'Molted', 'Intermolt'))
# sets parameters to compare removed, molted, and intermolt crabs

plot(hemo_ri ~ out_rmi_fin, data=se_dat_fin,
        main = 'Initial hemolymph protein concentration in green crabs',
        subset = start_end == "start",
        xlab = NULL, ylab = 'Protein Concentration',
        col= c('steelblue4', 'plum', 'springgreen4'))

```

```{r sig testing Initial Hemo Protein in GC conditions}

initial_ri_mod <- lm(hemo_ri ~ outcome, data=se_dat, 
                     subset = start_end == "start")
# builds model to evaluate hemo ri vs. crab outcome

nobs(initial_ri_mod)

plot(initial_ri_mod) # tests assumptions of normality
summary(initial_ri_mod)
anova(initial_ri_mod)
car::Anova(initial_ri_mod, type = 3)

# outcome is significantly related to hemolymph RI
```
```{r sig testing Initial Hemo Protein in GC conditions}

upd_ri_mod <- lm(hemo_ri ~ outcome, data=se_dat_upd, 
                     subset = start_end == "start")
# builds model to evaluate hemo ri vs. crab outcome

nobs(upd_ri_mod)

plot(upd_ri_mod) # tests assumptions of normality
summary(upd_ri_mod)
anova(upd_ri_mod)
car::Anova(upd_ri_mod, type = 3)

```

```{r sig testing Initial Hemo Protein in GC conditions}

fin_ri_mod <- lm(hemo_ri ~ outcome, data=se_dat_fin, 
                     subset = start_end == "start")
# builds model to evaluate hemo ri vs. crab outcome

nobs(fin_ri_mod)

plot(fin_ri_mod) # tests assumptions of normality
summary(fin_ri_mod)
anova(fin_ri_mod)
car::Anova(fin_ri_mod, type = 3)

fin_ri_aov <- aov (hemo_ri ~ outcome, data=se_dat_fin)
TukeyHSD(fin_ri_aov, conf.level = 0.95) 

```

```{r}
boxplot(hemo_color ~ start_end:outcome, data=se_dat,
        main = 'Initial vs. Final Hemolymph Color of Removed, Dead, and 
        Molted Crabs',
        xlab = 'Condition', ylab = 'Hemolymph Color',
        col= c('steelblue4', 'steelblue4', 'plum', 'plum', 'springgreen4',
               'springgreen4'))

```

```{r initial hemo color of crabs}

plot(hemo_color ~ outcome, data=se_dat, 
    main = 'Initial Hemolymph Color of Removed, Dead, and
    Molted Crabs', subset = start_end == "start",
    xlab = 'Condition', ylab = 'Hemolymph Color',
    col= c('steelblue4', 'plum', 'springgreen4'))

```

```{r glm for hemo color}

as.factor(se_dat_fin$hemo_col)
as.numeric(se_dat_fin$outcome == "Molted")

col_out_mod <- glm(outcome ~ hemo_col, family = binomial, data = se_dat_fin)

col_out_mod

plot(col_out_mod)

anova(col_out_mod)
```

```{r}

library(lavaan)

outmod <- "outcome ~ hemo_col + hemo_ri + condo_id + sex, 
data = se_dat_fin"

fitmod <- sem(outmod, data=se_dat_fin)

summary(fitmod, fit.measures=TRUE, rsquare=TRUE)

```