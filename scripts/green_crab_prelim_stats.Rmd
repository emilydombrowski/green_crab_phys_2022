---
output:
  pdf_document: default
  html_document: default
---
# Green crab data processing

# Data read in
These are the data sets, filtering steps, and libraries used to construct plots and statistical analyses. The main data cleaning step involved changing variable types (changing categorical factors to numeric, for example).
```{r data read in}

# read in relevant documents for this data
# preliminary data used for calcium etc.

# data used to produce calcium plots
# calcium data came from a limited set of crabs
gc_dat <- read.csv("../data/prelim_gc_data.csv")

# updated with full data set 2023-01-06

gc_dat_fin <- read.csv("../data/Condo_Data_Raw_CML_WEL_1_6_23.csv")

# define color levels as factor for future analyses
gc_dat_fin$hemo_col <- factor(gc_dat_fin$hemo_col,
                           levels = c('1', '2', '3', '4', '5'))

gc_dat_fin$hemo_col <- as.factor(gc_dat_fin$hemo_col)

# define hemolymph refractive index (RI) as numerics
gc_dat_fin$hemo_ri <- as.numeric(gc_dat_fin$hemo_ri)

# data reclassification to avoid errors later

# libraries for data visualization
library(ggplot2)
library(dplyr)
library(gridExtra)
library(MASS)
library(janitor)
```

# RI vs. Color Plots
```{r RI vs. Color FILTERED for WELLS only crabs}

boxplot(hemo_ri ~ hemo_col, data = gc_dat_fin,
      xlab = "Hemolymph Color",
      ylab = "Hemolymph Refractive Index",
      col= c('white', 'aliceblue', 'bisque', 'darksalmon','coral'),
      subset = condo_id == "WL" & 
        outcome == c('Molted', 'Removed'))
```
```{r Tukey HSD test and anova for color and RI fin filtered for WELLS}

fcol <- factor(gc_dat_fin$hemo_col)
# color is on a scale of 1-5; appears as "numeric"; categorical factor
# stores the variable hemolymph color as a factor (fcol)

ri_col_aov <- aov (hemo_ri ~ fcol, data=gc_dat_fin,
                       subset = condo_id == "WL" & 
                         outcome == c('Molted', 'Removed'))

summary(ri_col_aov)
# type 1 aov used for Tukey test
# tests between categories: is 1 dif. than 2, etc.

TukeyHSD(ri_col_aov, conf.level = 0.95) 
```

# New data frame to check previous results
To make sure that everything was showing up how I intended in the other figures and to double check the subsetting, I made a new data frame titled *filt* with only crabs from wells that molted and were removed. This data frame only contains the crab id, hemolymph ri, and hemolymph colors. I reconstructed the same boxplot and anova/tukey hsd testing.
```{r}
gc_dat_clean <- clean_names(gc_dat_fin)
# use janitor to clean

filt <- gc_dat_clean[gc_dat_clean$condo_id == "WL" & 
                     gc_dat_clean$outcome == c('Molted','Removed'),
                     c("crab_id", "hemo_ri", "hemo_col")]
# write data table with filtered data 

write.csv(filt, "filt_gc_dat.csv", 
          sep="\t",
          quote=F,
          row.names = F,
          col.names = T)

# make boxplot with filtered data to double check other graph
boxplot(hemo_ri ~ hemo_col, data = filt,
      xlab = "Hemolymph Color",
      ylab = "Hemolymph Refractive Index",
      col= c('white', 'aliceblue', 'bisque', 'darksalmon','coral'))

# n = 83, 85, 125, 21, 7
# gc n = 92

fcol_filt <- factor(filt$hemo_col)
# color is on a scale of 1-5; appears as "numeric"; categorical factor

ri_col_aov_filt <- aov (hemo_ri ~ fcol_filt, data=filt)
summary(ri_col_aov_filt)
# type 1 aov used for Tukey test
# tests between categories: is 1 dif. than 2, etc.

TukeyHSD(ri_col_aov_filt, conf.level = 0.95) 
```
# Calcium plots
```{r Ca vs. color}

boxplot(ca ~ hemo_col, data = gc_dat_fin,
      xlab = "Hemolymph Color",
      ylab = "Calcium (ppm)",
      col= c('white', 'aliceblue', 'bisque', 'darksalmon','coral'),
      
      subset = period == "TRUE", outline = FALSE)

# appears that calcium increases as hemolymph color darkens
# n = 25 individual crabs
# n = 11, 10, 36, 6, 2
```

```{r RI vs. Calcium Plot ggplot with confidence int.}

# Preliminary visualization from older dataset

gc_dat %>% 
        # pipes molt data into ggplot
  ggplot(aes(x = RI, y = Ca)) + 
        # populates plot with hemo ri and ca info
    geom_point() + geom_smooth(method=lm) + 
        # specifies type of plot -- linear model with 95 percent confidence
        xlab("Hemolymph Refractive Index") + 
        ylab ("Calcium (ppm)")  +
        # renames x and y labels and title
      xlim(3, 12) + 
        # specifies x axis between 3 and 12 for more clear visualization
      theme(panel.grid.major = element_blank(),
              panel.grid.minor = element_blank(), 
              panel.background = element_blank())
```

```{r ca vs ri significance testing}
ca_ri_mod <- lm(Ca ~ RI, data = gc_dat)
nobs(ca_ri_mod) # tells that there are 127 observations used in this model
summary(ca_ri_mod)
anova(ca_ri_mod) # standard anova
car::Anova(ca_ri_mod, type = 3) # type 3 anova for significance testing
# taken from all during molt cycle, leading to lots of variation
# pointing to trend; small r^2 due to assessing crabs at different times of
# molt cycle
```
